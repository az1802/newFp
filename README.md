### 功能模块的划分  

根据功能模块确定各个功能模块的对象实体,建立module baseData;
点餐行为
静态数据源
菜单,订单的信息

操作相关数据源
点餐行为(选中菜品)
基础数据  选中菜品数组 -->  菜品的选择数量,菜品的总价,菜品的立减价格,菜品的饭票价
行为     添加,删除,清空

订单信息
全局订单
商户订单

商户信息展示

个人信息展示
1 基本信息
2 钱包信息
3 个人全包


营销行为
饭票(饭票列表,最低饭票,最高饭票,根据金额与饭票余额推荐的饭票)
券包(券包列表,最低券包,最高券包,用户自有券包,最低消费金额的券包)
储值(储值列表,最低储值,最高储值,)

支付行为
 数据来源  订单信息,用户钱包信息,计算出的饭票推荐  储值推荐 会员支付等
1 订单支付
  饭票支付,全包合并支付,饭票合并支付,储值支付,储值合并支付,会员支付,微信支付,支付宝支付,
  明确各个支付方式的共参数共同点 与 区别点
2 券包购买支付
3 饭票购买支付
4 饭票的退款
5 券包的退款






### 组件的划分

* 页面级组件,页面大功能模块组件,功能细分的组件
* 共用组件(区分交互组件,纯展示组)



### 数据流

* 基础数据->计算属性数据->逻辑上的应用

* 每一个数据可能用在不同的组件页面.各个module里面的数据进行不同的组合,组合成hooks(考虑如何解决页面 hooks过多的问题)

* 深层对象的污染问题  在组建的什么级别阶段建立深拷贝阻断数据的污染

  



## 测试

### 点餐页面的逻辑

1点餐相关
1.1菜品分为
  a 单品菜(价格=菜品价格-菜品优惠)
  b 规格菜(可以选择属性和加料,价格=菜品价格+属性价格+加料价格-菜品优惠)
  c 套餐(价格=套餐原价+子菜加价-套餐优惠)
1.2菜品属性(商户助手可设置)
  a 单选
  b 单选非必选
  c 多选
  d 多选非必选
1.3菜品加料
  a 可以设置加料的数量选择范围
1.4打包费
  a 阶梯打包费(不同总价门槛收取不同的打包费)
  b 按菜品收取打包费(菜品总的打包盒数量*打包盒价格)
1.5菜品状态
  a 不在售卖时间(开启非售卖时间菜品显示,会显示非售卖时间菜品)
  b 售罄(开启菜品售罄显示,会显示售罄菜品)
  c 正常售卖
1.5购物车
  a 显示菜品的价格,数量,菜品总的打包费,菜品的属性,加料选择简介
  b 可对菜品进行增,减操作
1.6 菜品搜索
  a 使用关键字对菜品搜索完成菜品增减
  b 可直接去下单到订单页
  c 菜品列表中,关键字高亮显示
2 营销相关(业务助手上进行相关配置)
2.1 banner配置为饭票则显示饭票banner(暂无其他配置可支持)
2.2 开屏页可配置为饭票,储值,无
2.3 购物车底部营销文案显示
  a 当有券包时显示券包的营销推荐
  b 无券包且配置饭票时显示饭票的营销文案
2.4 配置显示范票价,则菜品显示对应的饭票价且点击时会跳转到饭票购买页面
3 订单记录查看
3.1 可查看订单用户在该商户下的订单,券包购买,饭票购买等信息与主页的订单页面一样



2 下单页面的逻辑
2.1 外卖模式选择地址和电话
2.2 显示所选菜品列表
2.3 菜品总价以及优惠信息(菜品折扣价+已选券包优惠)
2.4 选择券包
2.5 勾选券包合并支付时,下单直接唤起微信支付,不跳转到支付页。
2.6 推荐菜弹窗(可以继续添加菜品)
2.7 配置饭票时底部显示饭票推荐文案
2.8 可填入备注信息,下单后订单详情和小票上可见

3 支付页面的支付逻辑
订单支付总价=菜品总价 - 菜品折扣优惠 - 券包抵扣;
只有钱包,微信支付时才可享受券包抵和菜品折扣优惠;
a 选择饭票支付(开启饭票支付才会显示饭票支付,开启饭票购买开关才显示饭票推荐列表)
  饭票余额足够,不显示推荐饭票。直接显示菜品总价和饭票价格
  饭票余额不够,根据还需支付的金额显示饭票推荐列表。选择推荐饭票,底部按钮文案发生变化,显示实付金额。
b 会员储值支付 (开启储值支付才会显示储值支付)
  显示菜品总价(不享受菜品折扣优惠,券包抵扣)
  储值不够时,显示储值推荐列表
c 钱包支付(默认显示,无需配置)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)
d 微信支付(默认显示,无需配置)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)
e 会员支付(用户是此门店的会员用户才显示)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)*会员折扣





### 页面测试样例

一 直接支付页面
1 不开启任何模式
  a 存在饭票余额显示饭票余额,支持饭票余额支付。金额栏显示实际支付饭票金额和预估饭票余额
  b 存在已有券包,显示已有券包 支持券包的切换并使用券包支付,金额栏显示实际支付价格和券包优惠
2 开启饭票营销
   当饭票余额不足或者没有余额时,输入金额时推荐可购买饭票,支付饭票的合并支付,并在金额栏显示实际支付金额和预估饭票余额
3 开启券包营销
   当用户没有该商户券包时,输入金额之后展示相关券包营销,支持券包合并支付,并在输入金额部分显示实际支付价格和券包价格,券包优惠的价格
4 支付成功
  支付成功之后跳转到订单页面
5 支付失败
  弹窗提示支付失败


二 首页
1 未登录
  显示登录按钮,必须登录才可进行其他内容显示
2 已登录
  显示饭票和储值支付二维码用于收银机支付 
  显示饭票余额列表
    点击商户名称可以跳转到该商户的饭票职业页面,显示饭票余额和支持饭票购买

三 订单页
1 点餐tab
  显示所有订单记录
  点击查看详情跳转到订单详情页面
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页
2 券包tab
  券包未使用可申请退款,已使用不能退款且有文字信息提示
  点击退款,弹窗选择理由进行退款
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页
3 饭票tab
  饭票未使用可申请退款,已使用不能退款且有文字信息提示
  点击退款,弹窗选择理由进行退款
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页

四 我的页面
  1 显示基本信息
    a 用户头像和用户名称
    b 用户用券次数
    c 已为用户节省金额
  2 点击钱包,跳转到用户钱包信息页面
  3 点击优惠券,跳转到用户所有优惠券信息
  4 点击反馈,到信息反馈页面提交反馈信息

五 用户钱包页面
  1 显示用户总资产(饭票和红包总额)
  2 查看用户饭票余额的具体信息
  3 红包提现(超过20 红包可提现到微信账户)
  4 红包明细(查看用户具体的红包领取记录)

六 用户饭票详情
  1 显示可用和不可用饭票列表
  2 可用饭票可以查看该张饭票的余额
  3 饭票可以查看到具体的消费记录

七 商户首页
  1 显示商户基本信息
  2 用户就餐模式选择然后跳转到点餐页面点餐
  3 存在推荐菜品显示推荐菜品
  4 存在券包显示券包列表 点击抢购直接唤起微信支付
  5 存在饭票显示饭票列表,点击购买须知查看规格,点击抢购直接唤起微信支付

八 点餐页(待补充)

九 订单下单页(待补充)

十 支付完成页面(待补充)



### 点餐页面的逻辑

##### 1点餐相关 

1.1菜品分为
  a 单品菜(价格=菜品价格-菜品优惠)
  b 规格菜(可以选择属性和加料,价格=菜品价格+属性价格+加料价格-菜品优惠)
  c 套餐(价格=套餐原价+子菜加价-套餐优惠)
1.2菜品属性(商户助手可设置)
  a 单选
  b 单选非必选
  c 多选
  d 多选非必选
1.3菜品加料
  a 可以设置加料的数量选择范围
1.4打包费
  a 阶梯打包费(不同总价门槛收取不同的打包费)
  b 按菜品收取打包费(菜品总的打包盒数量*打包盒价格)
1.5菜品状态
  a 不在售卖时间(开启非售卖时间菜品显示,会显示非售卖时间菜品)
  b 售罄(开启菜品售罄显示,会显示售罄菜品)
  c 正常售卖
1.5购物车
  a 显示菜品的价格,数量,菜品总的打包费,菜品的属性,加料选择简介
  b 可对菜品进行增,减操作
1.6 菜品搜索
  a 使用关键字对菜品搜索完成菜品增减
  b 可直接去下单到订单页
  c 菜品列表中,关键字高亮显示
2 营销相关(业务助手上进行相关配置)
2.1 banner配置为饭票则显示饭票banner(暂无其他配置可支持)
2.2 开屏页可配置为饭票,储值,无
2.3 购物车底部营销文案显示
  a 当有券包时显示券包的营销推荐
  b 无券包且配置饭票时显示饭票的营销文案
2.4 配置显示范票价,则菜品显示对应的饭票价且点击时会跳转到饭票购买页面
3 订单记录查看
3.1 可查看订单用户在该商户下的订单,券包购买,饭票购买等信息与主页的订单页面一样



2 下单页面的逻辑
2.1 外卖模式选择地址和电话
2.2 显示所选菜品列表
2.3 菜品总价以及优惠信息(菜品折扣价+已选券包优惠)
2.4 选择券包
2.5 勾选券包合并支付时,下单直接唤起微信支付,不跳转到支付页。
2.6 推荐菜弹窗(可以继续添加菜品)
2.7 配置饭票时底部显示饭票推荐文案
2.8 可填入备注信息,下单后订单详情和小票上可见


3 支付页面的支付逻辑
订单支付总价=菜品总价 - 菜品折扣优惠 - 券包抵扣;
只有钱包,微信支付时才可享受券包抵和菜品折扣优惠;
a 选择饭票支付(开启饭票支付才会显示饭票支付,开启饭票购买开关才显示饭票推荐列表)
  饭票余额足够,不显示推荐饭票。直接显示菜品总价和饭票价格
  饭票余额不够,根据还需支付的金额显示饭票推荐列表。选择推荐饭票,底部按钮文案发生变化,显示实付金额。
b 会员储值支付 (开启储值支付才会显示储值支付)
  显示菜品总价(不享受菜品折扣优惠,券包抵扣)
  储值不够时,显示储值推荐列表
c 钱包支付(默认显示,无需配置)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)
d 微信支付(默认显示,无需配置)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)
e 会员支付(用户是此门店的会员用户才显示)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)*会员折扣

1 整个页面的高度
a 头部导航栏高度  与 statusHeight 有关
b menu高度
c banner高度
d 待付款的高度
e 底部padding留出给点菜












https://shilai.zhiyi.cn/v1.6/order/get/dcb51bc95528408c8f6f338cb895d85d




1 