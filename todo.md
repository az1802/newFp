
菜品搜索  //搜索菜  待定




支付完成 只有红包弹窗  企微 加入企微 等移除 
8 支付完成页面弹窗  //单独的红包限时逻辑  
订单缺少取餐码部分
14 菜品打包费相关   计算每个菜品打包费的价格  最终显示在购物车和订单列表页面
15 套餐在订单列表的显示逻辑





后付款模式的交互
多人点餐   
lodash工具库转换为本地代码  支付宝小程序不识别




后续加强
1 各个请求的模拟参数单独测试

外卖  不需要桌台
外带  不需要桌台
自提
堂食  扫码点餐桌台选择

正常需要选择 扫码点餐人数选择
添加必选菜


首页选择 自提 外卖 外带跳转过来的处理方式为什么可以不扫码直接下单 同时不带有tableId

人数选择
堂食扫码

tableId不存在则需要扫码

















价格计算逻辑
1 菜品总价  菜品的折扣价部分  菜品打包费部分 优惠小计
2 券包抵扣费用
3 支付页面
  饭票支付   菜品总价+打包费部分  已饭票折扣支付
  储值支付   菜品总价+打包费部分  储值金额支付
  红包/支付宝/微信支付  菜品总价-菜品的折扣价部分+菜品打包费部分 - (券包抵扣金额)
  会员支付  (以上处理部分)*折扣   (是否要考虑券包抵扣金额)


1 码牌支付
  饭票支付
    饭票合并支付
      第一次购买        直接支付并计算饭票余额
      已有余额合并支付   计算饭票最终余额
    饭票直接支付
      实时计算饭票余额  不断通过请求更新
  原价支付
  券包支付 
    券包合并支付
    单独券包抵扣支付


首页  显示各个商家下的饭票余额   点击购买饭票




支付
基础参数

1 打包费
2 组id
3 使用券包id



paidFee 支付金额


//是否已经选择饭票



1 显示与饭票,券包营销(输入金额才显示)
2 有饭票余额和券包  一直显示

2 饭票余额够
实付金额  没有划线

2 饭票余额不够  
  完全没有余额 输入金额 显示营销   显示饭票价 
  余额不够 默认选择第一条饭票    实付金额为购买饭票金额  计算饭票余额
  点击选择饭票(默认选择饭票)    实付金额显示  原价  预估饭票余额


已有券包(根据金额计算券包的显示逻辑)
券包营销   推荐券包不默认选择





首页的跳转逻辑
堂食判断进来的二维码有没有tableId tableName


没有tableId tableName需要扫桌台码
堂食需要选择peopleCount
createOrderPageJumped 待确定
选择桌台并进行支付 select-table待确定
强制收取手机号功能
点餐页加菜和多人点餐的逻辑


todo
直接支付页面 箭头确实图片
券包的选择需要处理 当切换支付方式之后的提示语,存在问题
券包过期提醒弹窗及功能未加

支付完成页面不同支付方式  小计和已优惠的显示内容
马牌支付的订单详情页没有菜品,需要UI调整

我的页面信息反馈页面可以后续优惠调整
首页券包抢购是否还需要跳转到特定券包页面 还是直接唤起微信支付
 case 'KERUYUN_FAST_FOOD': 堂食的支持


页面测试样例

一 直接支付页面
1 不开启任何模式
  a 存在饭票余额显示饭票余额,支持饭票余额支付。金额栏显示实际支付饭票金额和预估饭票余额
  b 存在已有券包,显示已有券包 支持券包的切换并使用券包支付,金额栏显示实际支付价格和券包优惠
2 开启饭票营销
   当饭票余额不足或者没有余额时,输入金额时推荐可购买饭票,支付饭票的合并支付,并在金额栏显示实际支付金额和预估饭票余额
3 开启券包营销
   当用户没有该商户券包时,输入金额之后展示相关券包营销,支持券包合并支付,并在输入金额部分显示实际支付价格和券包价格,券包优惠的价格
4 支付成功
  支付成功之后跳转到订单页面
5 支付失败
  弹窗提示支付失败


二 首页
1 未登录
  显示登录按钮,必须登录才可进行其他内容显示
2 已登录
  显示饭票和储值支付二维码用于收银机支付 
  显示饭票余额列表
    点击商户名称可以跳转到该商户的饭票职业页面,显示饭票余额和支持饭票购买

三 订单页
1 点餐tab
  显示所有订单记录
  点击查看详情跳转到订单详情页面
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页
2 券包tab
  券包未使用可申请退款,已使用不能退款且有文字信息提示
  点击退款,弹窗选择理由进行退款
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页
3 饭票tab
  饭票未使用可申请退款,已使用不能退款且有文字信息提示
  点击退款,弹窗选择理由进行退款
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页

四 我的页面
  1 显示基本信息
    a 用户头像和用户名称
    b 用户用券次数
    c 已为用户节省金额
  2 点击钱包,跳转到用户钱包信息页面
  3 点击优惠券,跳转到用户所有优惠券信息
  4 点击反馈,到信息反馈页面提交反馈信息

五 用户钱包页面
  1 显示用户总资产(饭票和红包总额)
  2 查看用户饭票余额的具体信息
  3 红包提现(超过20 红包可提现到微信账户)
  4 红包明细(查看用户具体的红包领取记录)

六 用户饭票详情
  1 显示可用和不可用饭票列表
  2 可用饭票可以查看该张饭票的余额
  3 饭票可以查看到具体的消费记录

七 商户首页
  1 显示商户基本信息
  2 用户就餐模式选择然后跳转到点餐页面点餐
  3 存在推荐菜品显示推荐菜品
  4 存在券包显示券包列表 点击抢购直接唤起微信支付
  5 存在饭票显示饭票列表,点击购买须知查看规格,点击抢购直接唤起微信支付

八 点餐页(待补充)

九 订单下单页(待补充)

十 支付完成页面(待补充)



v1.6/transaction/buy_fanpiao/list



package-payment/direct-payment/direct-payment?merchantId=8ec573585d9645229fb01713e30a2a6d





1 选择人数场景 确定  是否只与开关有关系
多人单餐是否展开选人数
必选菜与人数有关  如果不打开选人数 统一默认是1人

2 订单复制颜色与自提颜色与机型有关






1 点餐模式
堂食  
外带 
外卖
自提
2 经营模式
正餐 快餐的与营销
3 付款设置
先付款  后付款


除堂室外  设置打包费 收费当时 阶梯或者按菜品收取
菜品添加时递增的数量
菜品月售数量显示


不同点餐模式佣金不同  前台不用处理