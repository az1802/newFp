
菜品搜索  //搜索菜  待定



8 支付完成页面弹窗  //单独的红包限时逻辑  
订单缺少取餐码部分
14 菜品打包费相关   计算每个菜品打包费的价格  最终显示在购物车和订单列表页面
15 套餐在订单列表的显示逻辑
后付款模式的交互
lodash工具库转换为本地代码  支付宝小程序不识别
券包过期提醒弹窗及功能未加
case 'KERUYUN_FAST_FOOD': 堂食的支持
没有tableId tableName需要扫桌台码
堂食需要选择peopleCount
createOrderPageJumped 待确定
选择桌台并进行支付 select-table待确定
强制收取手机号功能





后续加强
1 各个请求的模拟参数单独测试


价格计算逻辑
1 菜品总价  菜品的折扣价部分  菜品打包费部分 优惠小计
2 券包抵扣费用
3 支付页面
  饭票支付   菜品总价+打包费部分  已饭票折扣支付
  储值支付   菜品总价+打包费部分  储值金额支付
  红包/支付宝/微信支付  菜品总价-菜品的折扣价部分+菜品打包费部分 - (券包抵扣金额)
  会员支付  (以上处理部分)*折扣   (是否要考虑券包抵扣金额)


页面测试样例

一 直接支付页面
1 不开启任何模式
  a 存在饭票余额显示饭票余额,支持饭票余额支付。金额栏显示实际支付饭票金额和预估饭票余额
  b 存在已有券包,显示已有券包 支持券包的切换并使用券包支付,金额栏显示实际支付价格和券包优惠
2 开启饭票营销
   当饭票余额不足或者没有余额时,输入金额时推荐可购买饭票,支付饭票的合并支付,并在金额栏显示实际支付金额和预估饭票余额
3 开启券包营销
   当用户没有该商户券包时,输入金额之后展示相关券包营销,支持券包合并支付,并在输入金额部分显示实际支付价格和券包价格,券包优惠的价格
4 支付成功
  支付成功之后跳转到订单页面
5 支付失败
  弹窗提示支付失败


二 首页
1 未登录
  显示登录按钮,必须登录才可进行其他内容显示
2 已登录
  显示饭票和储值支付二维码用于收银机支付 
  显示饭票余额列表
    点击商户名称可以跳转到该商户的饭票职业页面,显示饭票余额和支持饭票购买

三 订单页
1 点餐tab
  显示所有订单记录
  点击查看详情跳转到订单详情页面
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页
2 券包tab
  券包未使用可申请退款,已使用不能退款且有文字信息提示
  点击退款,弹窗选择理由进行退款
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页
3 饭票tab
  饭票未使用可申请退款,已使用不能退款且有文字信息提示
  点击退款,弹窗选择理由进行退款
  点击复制按钮可以复制订单号
  点击商户名称跳转到商户首页

四 我的页面
  1 显示基本信息
    a 用户头像和用户名称
    b 用户用券次数
    c 已为用户节省金额
  2 点击钱包,跳转到用户钱包信息页面
  3 点击优惠券,跳转到用户所有优惠券信息
  4 点击反馈,到信息反馈页面提交反馈信息

五 用户钱包页面
  1 显示用户总资产(饭票和红包总额)
  2 查看用户饭票余额的具体信息
  3 红包提现(超过20 红包可提现到微信账户)
  4 红包明细(查看用户具体的红包领取记录)

六 用户饭票详情
  1 显示可用和不可用饭票列表
  2 可用饭票可以查看该张饭票的余额
  3 饭票可以查看到具体的消费记录

七 商户首页
  1 显示商户基本信息
  2 用户就餐模式选择然后跳转到点餐页面点餐
  3 存在推荐菜品显示推荐菜品
  4 存在券包显示券包列表 点击抢购直接唤起微信支付
  5 存在饭票显示饭票列表,点击购买须知查看规格,点击抢购直接唤起微信支付

八 点餐页(待补充)

九 订单下单页(待补充)

十 支付完成页面(待补充)



v1.6/transaction/buy_fanpiao/list



package-payment/direct-payment/direct-payment?merchantId=8ec573585d9645229fb01713e30a2a6d





1 选择人数场景 确定  是否只与开关有关系
多人单餐是否展开选人数
必选菜与人数有关  如果不打开选人数 统一默认是1人

2 订单复制颜色与自提颜色与机型有关






1 点餐模式
堂食  
外带 
外卖
自提
2 经营模式
正餐 快餐的与营销
3 付款设置
先付款  后付款


除堂室外  设置打包费 收费当时 阶梯或者按菜品收取
菜品添加时递增的数量
菜品月售数量显示







1 菜品搜索页面待完成
2 后付款模式待完成
3 储值合并支付的问题




点餐页面的逻辑
1点餐相关
1.1菜品分为
  a 单品菜(价格=菜品价格-菜品优惠)
  b 规格菜(可以选择属性和加料,价格=菜品价格+属性价格+加料价格-菜品优惠)
  c 套餐(价格=套餐原价+子菜加价-套餐优惠)
1.2菜品属性(商户助手可设置)
  a 单选
  b 单选非必选
  c 多选
  d 多选非必选
1.3菜品加料
  a 可以设置加料的数量选择范围
1.4打包费
  a 阶梯打包费(不同总价门槛收取不同的打包费)
  b 按菜品收取打包费(菜品总的打包盒数量*打包盒价格)
1.5菜品状态
  a 不在售卖时间(开启非售卖时间菜品显示,会显示非售卖时间菜品)
  b 售罄(开启菜品售罄显示,会显示售罄菜品)
  c 正常售卖
1.5购物车
  a 显示菜品的价格,数量,菜品总的打包费,菜品的属性,加料选择简介
  b 可对菜品进行增,减操作
1.6 菜品搜索
  a 使用关键字对菜品搜索完成菜品增减
  b 可直接去下单到订单页
  c 菜品列表中,关键字高亮显示
2 营销相关(业务助手上进行相关配置)
2.1 banner配置为饭票则显示饭票banner(暂无其他配置可支持)
2.2 开屏页可配置为饭票,储值,无
2.3 购物车底部营销文案显示
  a 当有券包时显示券包的营销推荐
  b 无券包且配置饭票时显示饭票的营销文案
2.4 配置显示范票价,则菜品显示对应的饭票价且点击时会跳转到饭票购买页面
3 订单记录查看
3.1 可查看订单用户在该商户下的订单,券包购买,饭票购买等信息与主页的订单页面一样



2 下单页面的逻辑
2.1 外卖模式选择地址和电话
2.2 显示所选菜品列表
2.3 菜品总价以及优惠信息(菜品折扣价+已选券包优惠)
2.4 选择券包
2.5 勾选券包合并支付时,下单直接唤起微信支付,不跳转到支付页。
2.6 推荐菜弹窗(可以继续添加菜品)
2.7 配置饭票时底部显示饭票推荐文案
2.8 可填入备注信息,下单后订单详情和小票上可见


3 支付页面的支付逻辑
订单支付总价=菜品总价 - 菜品折扣优惠 - 券包抵扣;
只有钱包,微信支付时才可享受券包抵和菜品折扣优惠;
a 选择饭票支付(开启饭票支付才会显示饭票支付,开启饭票购买开关才显示饭票推荐列表)
  饭票余额足够,不显示推荐饭票。直接显示菜品总价和饭票价格
  饭票余额不够,根据还需支付的金额显示饭票推荐列表。选择推荐饭票,底部按钮文案发生变化,显示实付金额。
b 会员储值支付 (开启储值支付才会显示储值支付)
  显示菜品总价(不享受菜品折扣优惠,券包抵扣)
  储值不够时,显示储值推荐列表
c 钱包支付(默认显示,无需配置)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)
d 微信支付(默认显示,无需配置)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)
e 会员支付(用户是此门店的会员用户才显示)
  显示订单支付总价(享受菜品折扣优惠,券包抵扣)*会员折扣

1 整个页面的高度
a 头部导航栏高度  与 statusHeight 有关
b menu高度
c banner高度
d 待付款的高度
e 底部padding留出给点菜



二维码入口的页面进行userId校验 当userId不存在的时候保存页面整体参数 跳转到登录页面登录   ok 
客如云模式 哗啦啦模式菜品的处理过程进行代码转移

扫码体验版进入之后菜品的选择弹窗仍旧是之前的   暂时不处理
支付页面储值支付余额没有更新问题  待验证
打包费还未处理(阶梯打包费,按菜品收取打包费)   不处理
头部备份内容被截掉   已处理

套餐(参考现有逻辑)




1 banner饭票营销倒计时时间的问题  下单页的时间是没有小时的  保持 分秒一致
2 



套餐初始化的时候的选择
客如云模式 哗啦啦模式菜品的处理过程进行代码转移



外卖模式
1 选择按钮调大 ok
2 保存之后刷新列表  ok
3 保存并使用并不会使用 暂时不处理 ok
4 进来已经有地址不默认选择第一个  ok
5 红包金额问题  待处理
6 点餐 折扣不对的问题  ok
7 配送费自动添加  ok 



模式不兼容的问题
堂食 外卖 自提 自带这些模式要根据二维码完全独立 不能共享
后付款控制全局
